{%  extends "::base.html.twig" %}

{% block pageTitle %}{{ anime.title }}{% endblock %}
{% block breadCrumbs %}
    <li><a href="{{ path('loopanime_shows_homepage') }}">Home</a></li>
    <li><a href="{{ path('loopanime_shows_listAnimes') }}">Series</a></li>
    <li class="active">{{ anime.title }}</li>
{% endblock %}

{% block body %}
<section class="slice bg-blue blue">
    <div class="wp-section work blue popular-animes">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-md-4">
                    <img data-original="{{ anime.poster | imagine_filter('animePagePoster') }}" class="thumbnail center-block lazy img-responsive col-sm-12"/>
                    <div class="col-sm-12">
                        {% if isFavorite %}
                            <a href="#" class="btn btn-block btn-alt btn-icon fa-check trigger-favorites" data-anime="{{ anime.id }}"><span>Added to Favorites</span></a>
                        {% else %}
                            <a href="#" class="btn btn-block btn-alt btn-icon fa-star-o trigger-favorites" data-anime="{{ anime.id }}"><span>Add to Favorites</span></a>
                        {% endif %}
                    </div>
                </div>
                <div class="col-sm-12 col-md-8">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="col-xs-3 text-center">
                                <i class="fa fa-calendar fa-2x"></i>
                                <br />
                                <span>{{ anime.startTime }}</span>
                            </div>
                            <div class="col-xs-3 text-center">
                                <i class="fa fa-heart fa-2x"></i>
                                <br />
                                <span>{{ animeInormation.totFavorites }}</span>
                            </div>
                            <div class="col-xs-3 text-center">
                                <i class="fa fa-comment-o fa-2x"></i>
                                <br />
                                <span>{{ animeInormation.totComments }}</span>
                            </div>
                            <div class="col-xs3 text-center">
                                <i class="fa fa-clock-o fa-2x"></i>
                                <br />
                                <span>{{ anime.runningTime }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 col-md-12">
                            <p class="text-justify anime-plot-summary">{{ anime.plotSummary }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="slice bg-white">
    <div class="wp-section work">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 carousel-container">
                    <div class="row">
                        <div class="col-xs-12 text-center">
                            <h4 class="title"><i class="fa fa-play-circle"></i><span> LATEST EPISODES</span></h4>
                        </div>
                        <div class="latest-episode text-center">
                            {# Carousel items #}
                            <div class="carousel-inner">
                                <div class="item active">
                                    {% for episode in latestEpisodes %}
                                        <div class="col-sm-6 col-md-3">
                                            <div class="col-sm-12">
                                                <a href="{{ path('loopanime_shows_episode', {episode: episode.id}) }}">
                                                    <img data-original="{% if episode.poster is not empty %}{{ episode.poster | imagine_filter('latestEpisodesCarouselThumb') }}{% else %}{{ episode.season.anime.poster | imagine_filter('latestEpisodesCarouselThumb') }}{% endif %}" alt="{{ episode.episodeTitle }}" width="250px" height="170px" class="thumbnail img-responsive lazy center-block">
                                                </a>
                                            </div>
                                            <div class="col-sm-12">
                                                <h4 class="title">{{ episode.episodeTitle }}</h4>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="slice light-gray bb animate-hover-slide">
    <div class="wp-section work">
        <div class="container">

            <div class="row">
                <div class="col-sm-12">
                    <div class="sort-list-btn seasons-numbers">
                        <h5 class="title">Seasons:</h5>
                        {% for season in seasons %}
                            <button type="button" class="btn {% if loop.first %}btn-base{% else %}btn-white{% endif %}" href="{{ path("loopanime_shows_season",{idSeason: season.id}) }}" data-season="{{ season.id }}">Season {{ season.season }}</button>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="row">
                <div id="ulSorList" class="episodes-container">
                    <div class="loading"></div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block javascript %}
<script type="text/javascript">
$(document).ready(function(e) {

    function updateDislikesAndLinkes(data) {
        if(data.hasOwnProperty('likes')) {
            $('#thumbs-up-counter').html(data.likes);
            $('#thumbs-down-counter').html(data.dislikes);
        }
    }

    function loadSeasonEpisodes(href) {
        if(href !== "") {
            $.ajax({
                url: href,
                type: 'GET'
            }).success(function(data) {
                $('.episodes-container').html(data);
                $("img.lazy").lazyload();
            });
        }
    }

    $(document).on('click','.episodes-container .pagination a',function(e) {
        e.preventDefault();
        console.log('clicked');
        loadSeasonEpisodes($(this).attr('href'));
    });

    $('.seasons-numbers button').click(function(e) {
        e.preventDefault();
        $('.seasons-numbers button.btn-base').removeClass('btn-base').addClass('btn-white');
        $(this).addClass('btn-base').removeClass('btn-white');
        var url = '{{ path("loopanime_shows_listEpisodes") }}?season=' + $(this).data('season');
        loadSeasonEpisodes(url);
    });

    $('.seasons-numbers button:first').trigger('click');

    // Like
    $('div.glyphicon-thumbs-up').click(function(e) {
        $.ajax({
            url: '{{ path("loopanime_shows_animeAjax") }}',
            data: {op: 'rating', id_anime: {{ anime.id }}, ratingUp: 1},
            dataType: 'JSON'
        }).done(function(data) {
            if(data.hasOwnProperty('data')) {
                data = data.data;
                updateDislikesAndLinkes(data);
                $('div.glyphicon-thumbs-down').css('color',"");
                $('div.glyphicon-thumbs-up').css('color',"green");
            }
        });
    });

    // Dislike
    $('div.glyphicon-thumbs-down').click(function(e) {
        $.ajax({
            url: '{{ path("loopanime_shows_animeAjax") }}',
            data: {op: 'rating', id_anime: {{ anime.id }}, ratingUp: 0},
            dataType: 'JSON'
        }).done(function(data) {
            if(data.hasOwnProperty('data')) {
                data = data.data;
                updateDislikesAndLinkes(data);
                $('div.glyphicon-thumbs-up').css('color', "");
                $('div.glyphicon-thumbs-down').css('color', "red");
            }
        });
    });

});
</script>
{% endblock %}